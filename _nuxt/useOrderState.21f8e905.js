import{m as u}from"./entry.ce2efe4f.js";var n=(r=>(r.Normal="Normal",r.Vip="Vip",r))(n||{}),o=(r=>(r.Pending="Pending",r.Processing="Processing",r.Complete="Complete",r))(o||{}),i=(r=>(r.Idle="Idle",r.Work="Work",r))(i||{});const l=u("useOrder",{state:()=>({cookingDuration:10,orderNumberCounter:0,botNumberCounter:0,listOrders:[],bots:[],cookingInterval:[]}),getters:{getPriorityOrdersByStatus:r=>t=>{const e=[...r.listOrders.filter(s=>s.type==n.Vip),...r.listOrders.filter(s=>s.type==n.Normal)].filter(s=>s.status==t);return t==o.Complete&&e.sort((s,d)=>d.completedAt-s.completedAt),e},totalBots:r=>r.bots.length,findIdleBot:r=>r.bots.find(t=>t.status==i.Idle),findBotByOrderNumber:r=>t=>r.bots.findIndex(e=>e.orderNumber==t)},actions:{increaseOrderNumber(){this.orderNumberCounter++},increaseBotNumber(){this.botNumberCounter++},addOrder(r){this.increaseOrderNumber(),this.listOrders.push({number:this.orderNumberCounter,type:r,status:o.Pending,processDuration:this.cookingDuration}),this.processingOrder()},addBot(){this.increaseBotNumber(),this.bots.push({id:this.botNumberCounter,status:i.Idle}),this.processingOrder()},minBot(){const r=this.bots[this.totalBots-1];r&&(r.orderNumber&&this.releaseOrderFromBot(r,o.Pending),this.bots.pop())},processingOrder(){const r=this.getPriorityOrdersByStatus("Pending");if(r.length<=0)return;const t=r[0],e=this.findIdleBot;e&&(this.assignBot(e,t),this.updateOrderStatus(t,o.Processing),this.startCounting(e,t))},startCounting(r,t){t.processDuration=10;const e=setInterval(()=>{t.processDuration--,t.processDuration<=0&&(this.releaseOrderFromBot(r,o.Complete),this.updateBotStatus(r,i.Idle),this.processingOrder())},1e3);this.cookingInterval[r.id]=e},assignBot(r,t){r.status=i.Work,r.orderNumber=t.number},updateOrderStatus(r,t){r.status=t,t==o.Complete&&(r.completedAt=new Date)},releaseOrderFromBot(r,t){const e=this.listOrders.find(s=>s.number==r.orderNumber);e&&(this.updateOrderStatus(e,t),r.orderNumber=0,this.cookingInterval[r.id]&&(clearInterval(this.cookingInterval[r.id]),delete this.cookingInterval[r.id]))},updateBotStatus(r,t){r.status=t}}});export{l as u};
